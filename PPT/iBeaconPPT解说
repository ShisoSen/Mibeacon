1. iBeacon 一切尽在掌握之中
看过one piece的人，都知道特拉法尔加.罗的手术果实能力，可以创造出一个任由自己操控的空间。在这个空间中，罗就是上帝，可以感知任何物件，然后自由操控。
当我们身处一个环境，如果能够准确地了解这个环境中的一草一木，掌握它们的位置信息，属性，那就做到了让周边这个场域在自己的掌握之中。
iBeacon 正式能够帮助我们实现这种能力的能力果实。

原本提出来了解iBeacon的初衷，可能是着眼于它在室内定位方面的功能。然而，正如标题所传达的主题，iBeacon是一个可以掌握一切的恶魔果实。所以，介绍过程中，并不会围绕室内定位这个点。为了让大家更快地了解，我们从日常离不开的一个app--微信--说起。
接触iBeacon？
2. 微信摇周边-准确获取周边事物信息。反客为主。
应该没有人没听说过微信摇一摇，过年的时候很多人围在电视旁，一边看春晚，一边摇手机，虽然摇到手抽筋也不一定来个红包。今年一月份，微信向外界发布了“摇一摇/周边”这个新功能。只要你开启了蓝牙，通过摇一摇手机，就会获得丰富的周边信息。
通常我们打开微信摇一摇，并没有周边这个选项。但当附近有可用的iBeacon信号时，就会出现新的选项“周边”。
通过摇周边，我们可以怎样？
图2-1
摇班车信息：用户在班车前摇一摇，获取乘车信息
摇住宿信息：用户在酒店大堂摇一摇，获取房间信息
摇一摇签到：用户在会场前摇一摇，成功签到
摇一摇投票：用户在晚会现场摇一摇，为节目投票，且投票结果直接显示在屏幕上
所有的这些场景中，我们不必要凑到站台信息跟前，查看班车信息，不需要花时间排队询问大堂服务员，也不需要每天挤电梯踩点刷手指，更不需要走到投票箱去投票。我们唯一要做的，就是摇一摇手机。

那么，微信摇周边这个功能，是怎么实现的呢？
3. 微信摇周边 创意解说
- iOS7.0发布的iBeacon技术，周边定位
- 基于周边定位，连接周边信息
- 摇一摇的主动触发方式，减少垃圾信息打扰

4. iBeacon 特点
- iBeacon在iOS7.0发布，发布以来，一直被寄予厚望，国外已有很多公司利用其功能，开发出很多有特色的app，在零售业，体育业，O2O等多个行业领域开始发挥变革性作用。在国内，也开始起步，比方说微信，支付宝，以及室内定位等很多方面，开始运用iBeacon的技术思维方式，来构建功能体系。
- iBeacon的基础是蓝牙4.0，这是一种低功耗蓝牙，所以相应的，iBeacon的也有着功耗低的特点。
- iBeacon的特色，也就聚焦在周边定位功能上。通过周边定位，获取与周边物体的relationship，是完成很多事物的关键。
- iBeacon在iOS系统上是可以后台运行的，同时获取实时的iBeacon源相对于receiver的距离状态，这样，就可以实现监控和通知。

具体实现方式？
5. iBeacon 介绍
iBeacon使用的是BLE技术，也就是低功耗蓝牙。具体而言，利用的是BLE中名为“通告帧”（Advertising）的广播帧。通告帧是定期发送的帧，只要是支持BLE的设备就可以接收到。iBeacon通过在这种通告帧的有效负载部分嵌入苹果自主格式的数据来实现。

iBeacon的数据主要由四种资讯构成，分别是UUID（通用唯一标识符）、Major、Minor、Measured Power。
- UUID是规定为ISO/IEC11578:1996标准的128位标识符。也就是我么平时用到的统一标识符。
- Major和Minor由iBeacon发布者自行设定，都是16位的标识符。比如，连锁店可以在Major中写入区域资讯，可在Minor中写入个别店铺的ID等。另外，在家电中嵌入iBeacon功能时，可以用Major表示产品型号，用Minor表示错误代码，用来向外部通知故障。
- Measured Power是iBeacon模块与接收器之间相距1m时的参考接收信号强（RSSI：Received Signal Strength Indicator）。接收器根据该参考RSSI与接收信号的强度来推算发送模块与接收器的距离。实际上，WiFi定位也好，iBeacon定位也好，都是通过RSSI，探知点对点的距离，然后通过网络中的已知定位点，通常称为ap（access point），来精确定位。

6. iBeacon 将距离简单分为3级
向iOS发送的距离并不是精密推算的，而是将其分为约10厘米（immediate）、1米以内（near）、1米以外（far）的三级（图3）。这是因为，发送与接受设备之间的距离在1米之内时，RSSI值基本是按照理论值减少的，而在1米以外，受到反射波的影响，RSSI不会减少，而是会上下波动。也就是说，1米以外的距离无法推测，只能用“far”来概括。

7. 不适合较远距离的精确测距
iBeacon传输的最大射程将取决于位置、现场布置、障碍物。就向在电梯里手机信号很差一样，iBeacon信号收到环境的影响。
标准信号有近似的70米，远程信号可达450米。但并不适合较远距离的精确测距。

介绍了iBeacon的基本技术特点，我们可以试着考虑一下应用场景。
8. 实现O2O应用场景
图8-1
对于上图场景，或许我们会设计出一种iBeacon交互场景。用户来到心仪的商品前，手机探测到这双鞋的iBeacon信号，接着跟鞋上的iBeacon源直接连接，取得这双鞋的更多信息。
然而，我们看到的实际上只是商品和用户线下之间的交互。并没体现出online的元素。这里要注意的是，但对iBeacon来说，它并不是一个用来传递信息的技术，通讯的话有蓝牙就可以。iBeacon本质是蓝牙通告帧，虽然作为基础的蓝牙技术可以实现点对点的通讯连接，但我们要注意到iBeacon并不等同于蓝牙。我们有必要了解iBeacon与Bluetooth之间的异同。

9. iBeacon 基于蓝牙的实现细节
图9-1
低功耗蓝牙有两种主状态:广播和连接。 
广播是单向的被发现机制，想要被发现的设备可以传输数据包每20ms到10秒。越短的时间间隔，越短的电池寿命，但设备发现速度越快。数据包可以加长至47个长度的字节，由以下构成: 
* 1字节报头
* 4字节访问地址
* 2-39字节广播频道PDU(Protocol Data Unit)
* 3字节CRC 
PDU有它自己的头部（两字节：负载的大小和它的类型—设备是否支持连接，等）和实际的数据负载（最长至37字节）。最后，负载的头六个字节是设备的MAC地址，实际的数据最长有31字节。
图9-2
Beacons通常使用广播频道，由beacon望文生义，他们每隔一段时间传输数据包，这些数据被设备像智能机接受，因此iBeacons是简单的低功耗蓝牙广播的特殊应用，iOS端加入了特别的支持。
尝试拦截一个蓝牙广播包，例如来自于Estimote beacon，你将看到下列数据：
02 01 06 1A FF 4C 00 02 15 B9 40 7F 30 F5 F8 46 6E AF F9 25 55 6B 57 FE 6D 00 49 00
以上数据已经有报文了，固定访问地址、广播PDU头和MAC地址被移除;它只有广播数据—30字节，因此它适应了31字节的限制。
什么使得蓝牙广播成为iBeacon？格式由苹果规定，分解如下：
02 01 06 1A FF 4C 00 02 15: iBeacon prefix (fixed) B9 40 7F 30 F5 F8 46 6E AF F9 25 55 6B 57 FE 6D: proximity UUID (here: Estimote’s fixed UUID) 00 49: major 00 0A: minor C5: 2’s complement of measured TX power 
所以，iBeacon并不是想要替代蓝牙的一种通讯技术，它基于蓝牙广告帧，是已一种单向的被发现机制，来传递相对位置信息。

也许有人越了解iBeacon的技术细节，越觉得没有多少技术含量。这不就是把蓝牙4.0的广告帧，塞了两个字节的信号强度而已么？数据的传输，还是得靠蓝牙来实现。
那么，什么才是iBeacon的实现模式？依然通过微信摇周边来看：
10. 微信摇周边的实现细节--iBeacon的实现思路
图10-1
从上图可以看出，iBeacon的实现模式中，少不了后台的支持。要实现摇一摇手机，显示出我们的商户信息，首先得到微信公众平台注册服务，然后得到服务对应的设置信息，对我们的iBeacon信号基站进行设置。这样一来，当我们的iBeacon基站向外界持续不断发送广播帧，当微信用户靠近我们的商户，摇一摇手机，得到iBeacon信号源信息，然后到微信后台服务器拉去数据，在手机上显示商户的详细信息。
所以，iBeacon实现的是获取到商户与用户之间的relationship，然而要实现更多强大的功能，比如签到，投票，商品折扣信息等等，则需要后台为依托，根据relationship，来准备相应的信息。
这才是iBeacon style！
实际上，不论是历史中，还是现代技术发展中，有很多微小的改变，却带来巨大变革的案例。比方说，对于游牧民族的马镫；比方说，当年微博和博客140字的差别。相信正如apple的希望一样，iBeacon必将带来新的变革。

然后，来谈一下一切尽在掌握之中的信心来源。
11. 一切尽在掌握之中的信心来源
之所以说iBeacon拥有类似于手术刀果实的恶魔之力，我总结了以下几个特点（个人观点..）。
- 发现 - 反应
描述一个人的行为方式，通常的一种模式是：发现，然后做出反应。能够提前发现，我们就能掌握主动权。想一想iBeacon，我们可以在接近这个事物的周边开始，接收到这个事物主动发送来的信息，然后从容地做出反应。官方一点来说，就是知己知彼百战不殆。通俗一点来说，就好比是玩Dota，没了战争迷雾（开黑）。
- 定位 - 引导
定位是iBeacon的一个重要特性，有了定位，就可以对用户进行引导，比如商场导流，室内引导等都可以以此实现。而相对于WiFi等其他手段，iBeacon更加低耗，同时低成本也是其部署上的优势之一。
- 关注 - 通知
说道iBeacon的周边定位，更希望把其形容为一种场域概念。在iOS上，iBeacon可以在后台实现对信号源的监控。比如说一个iBeacon信号的进场与出场，信号的远近。通过关注信号源与监测点的相对关系，可以灵活地设置各种通知。可以想象把iBeacon放在你的宠物身上，可以智能的提醒你，你的宠物是不是又不见了。同样，对于顾客和商店，了解顾客与用户的位置关系，可以方便商店推送他们的信息。
- 语境运算(contextual computing)
iBeacon很好的提供了物体之间的关系信息，这些信息围绕着位置关系展开，可能是相对距离，可能是一段时间内的运动轨迹，这种关系可以描述行为，也可能表征兴趣。语境运算，即是通过当前的语境，比方说环境，兴趣，行为，根据态势来感知，推断出下一步的行动。就如同第六感，推断出最可能的，无意识状况下的动作。无论通过大数据也好，机器学习也好，总之通过与iBeacon的结合，势必能为这些领域提供更为强大得支持。举个最简单的例子，通过iBeacon，我们可以获取用户更喜欢逛的商户，更轻松的得出用户的购物喜好。

以上描述了我认为的iBeacon的特点，以及可能会有出彩的应用模式。那么，实际中有哪些使用到iBeacon的应用场景呢？

12. iBeacon应用场景







